(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{MUEz:function(n,t){n.exports='<div class="row">\n  <div class="col-md-4 col-xs-12">\n    <sa-card title="\u6dfb\u52a0\u516c\u544a">\n      <form class="announcement-form"\n            [formGroup]="editForm" \n            (ngSubmit)="submitEditForm(editForm.value)">\n        <div class="form-group" [ngClass]="controlStateClass(state)">\n          <label for="announcement-type">\n            <h5>\u516c\u544a\u72b6\u6001</h5>\n          </label>\n          <select class="form-control c-select" id="announcement-type" [formControl]="state">\n            <option [value]="PublishState.published">\u5df2\u53d1\u5e03</option>\n            <option [value]="PublishState.draft">\u8349\u7a3f</option>\n          </select>\n        </div>\n        <div  class="form-group" [ngClass]="controlStateClass(content)">\n          <label for="announcement-content">\n            <h5>\u516c\u544a\u5185\u5bb9</h5>\n          </label>\n          <sa-markdown-editor\n            id="announcement-content"\n            class="form-control announcement-content" \n            title="\u6587\u7ae0\u5185\u5bb9"\n            [config]="{ lineWrapping: true }"\n            [formControl]="content">\n          </sa-markdown-editor>\n        </div>\n        <hr>\n        <div class="col-sm-12">\n          <button type="submit"\n                  class="btn btn-success btn-with-icon"\n                  [disabled]="!editForm.valid">\n            <i class="ion-md-done-all"></i>\n            <span>{{ activeAnnouncement ? \'\u4fee\u6539\' : \'\u6dfb\u52a0\' }}\u516c\u544a</span>\n          </button>\n          <span>&nbsp;&nbsp;</span>\n          <button class="btn btn-default btn-with-icon" (click)="resetEditForm()">\n            <i class="ion-md-refresh"></i>\n            <span>\u91cd\u7f6e</span>\n          </button>\n        </div>\n      </form>\n    </sa-card>\n  </div>\n  <div class="col-md-8 col-xs-12">\n    <sa-card title="\u5168\u90e8\u516c\u544a" baCardClass="with-scroll">\n      <div class="clearfix">\n        <div class="pull-left">\n          <div class="btn-group">\n            <button type="button"\n                    class="btn btn-default active"\n                    [ngClass]="{ \'active\': isState(PublishState.all) }"\n                    (click)="switchState(PublishState.all)">\n              <span>\u5168\u90e8</span>\n              <span *ngIf="isState(PublishState.all)">&nbsp;({{ currentListTotal }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': isState(PublishState.published) }"\n                    (click)="switchState(PublishState.published)">\n              <span>\u5df2\u53d1\u5e03</span>\n              <span *ngIf="isState(PublishState.published)">&nbsp;({{ currentListTotal }})</span>\n            </button>\n            <button type="button"\n                    class="btn btn-default"\n                    [ngClass]="{ \'active\': isState(PublishState.draft) }"\n                    (click)="switchState(PublishState.draft)">\n              <span>\u8349\u7a3f</span>\n              <span *ngIf="isState(PublishState.draft)">&nbsp;({{ currentListTotal }})</span>\n            </button>\n          </div>\n          <span>&nbsp;&nbsp;</span>\n          <div class="btn-group" role="group">\n            <button type="button" \n                    class="btn btn-default btn-with-icon" \n                    (click)="refreshAnnouncements()">\n              <i class="ion-md-refresh"></i>\n              <span>\u5237\u65b0</span>\n            </button>\n            <button type="button" \n                    class="btn btn-default btn-with-icon"\n                    (click)="resetSearchForm()">\n              <i class="ion-md-trash"></i>\n              <span>\u6e05\u7a7a\u5173\u952e\u8bcd</span>\n            </button>\n            <div class="btn-group" dropdown [isDisabled]="!selectedAnnouncements.length">\n              <button type="button"\n                      class="btn btn-default btn-with-icon dropdown-toggle"\n                      dropdownToggle>\n                <i class="ion-md-list"></i>\n                <span>\u6279\u91cf\u64cd\u4f5c</span>\n              </button>\n              <ul class="dropdown-menu" *dropdownMenu>\n                <li class="dropdown-item">\n                  <a [href]="" (click)="openBatchDelModal()">\u6279\u91cf\u5220\u9664</a>\n                </li>\n              </ul>\n            </div>\n          </div>\n        </div>\n        <form class="pull-right form-inline navbar-form announcement-search-form" \n              [formGroup]="searchForm" \n              (ngSubmit)="submitSearchForm(searchForm.value)">\n          <div class="input-group" style="margin: 0">\n            <input type="text"\n                   placeholder="\u516c\u544a\u5185\u5bb9"\n                   [formControl]="keyword"\n                   class="form-control with-default-addon">\n            <span class="input-group-btn">\n              <button class="btn btn-default" type="submit" [disabled]="!searchForm.valid">\u641c\u7d22</button>\n            </span>\n          </div>\n        </form>\n      </div>\n      <div class="table-responsive">\n        <div class="announcement-list">\n          <sa-loading-spider [show]="fetching.get"></sa-loading-spider>\n          <table class="table table-striped table-no-borders black-muted-bg table-enrich">\n            <thead class="thead-inverse">\n              <tr>\n                <th class="batch-checkbox">\n                  <sa-checkbox [(ngModel)]="announcementsSelectAll" (ngModelChange)="handleBatchSelectChange($event)">\n                    <span sa-checkbox-label>\n                      <span>&nbsp;</span>\n                      <strong>ID</strong>\n                    </span>\n                  </sa-checkbox>\n                </th>\n                <th width="50%">\u5185\u5bb9</th>\n                <th class="text-center">\u72b6\u6001</th>\n                <th class="text-center">\u64cd\u4f5c</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr *ngIf="!announcements.data.length;else dataList">\n                <td colspan="7">\n                  <p class="text-muted text-center announcement-err-msg">\n                    <span>{{ fetching.get ? \'\u6570\u636e\u8bf7\u6c42\u4e2d...\' : \'\u6682\u65e0\u6570\u636e\' }}</span>\n                  <p>\n                </td>\n              </tr>\n              <ng-template #dataList>\n                <tr *ngFor="let announcement of announcements.data">\n                  <td class="batch-checkbox">\n                    <sa-checkbox [(ngModel)]="announcement.selected" (ngModelChange)="handleItemSelectChange()">\n                      <span sa-checkbox-label>\n                        <span>&nbsp;</span>\n                        <strong>{{ announcement.id }}</strong>\n                      </span>\n                    </sa-checkbox>\n                  </td>\n                  <td>\n                    <div class="content ql-editor" \n                         [innerHTML]="parseMarkdown(announcement.content)"></div>\n                  </td>\n                  <td align="center">\n                    <span>{{ announcement.state === PublishState.published ? \'\u5df2\u53d1\u5e03\' : \'\u8349\u7a3f\' }}</span>\n                    <span>&nbsp;&nbsp;</span>\n                    <i class="ion-md-checkmark text-success" *ngIf="announcement.state === PublishState.published"></i>\n                    <i class="ion-md-create text-warning" *ngIf="announcement.state === PublishState.draft"></i>\n                  </td>\n                  <td>\n                    <div class="text-center">\n                      <div class="btn-group" role="group">\n                        <button type="button"\n                                class="btn btn-sm btn-warning"\n                                (click)="editAnnouncement(announcement)">\u7f16\u8f91\u516c\u544a</button>\n                        <button type="button"\n                                class="btn btn-sm btn-danger"\n                                (click)="openDelModal(announcement)">\u5220\u9664\u516c\u544a</button>\n                      </div>\n                    </div>\n                  </td>\n                </tr>\n              </ng-template>\n            </tbody>\n          </table>\n          <br>\n          <div class="text-center" *ngIf="announcements.pagination">\n            <pagination class="pagination-xs"\n                        firstText="\u9996\u9875"\n                        lastText="\u672b\u9875"\n                        nextText="\u4e0b\u4e00\u9875"\n                        previousText="\u4e0a\u4e00\u9875"\n                        pageBtnClass="btn-primary"\n                        [totalItems]="announcements.pagination.total"\n                        [itemsPerPage]="announcements.pagination.per_page"\n                        [(ngModel)]="announcements.pagination.current_page"\n                        [maxSize]="7"\n                        [boundaryLinks]="true"\n                        [rotate]="false"\n                        (pageChanged)="handlePageChanged($event)">\n            </pagination>\n          </div>\n        </div>\n      </div>\n    </sa-card>\n  </div>\n  \x3c!-- \u5220\u9664\u786e\u8ba4\u5f39\u7a97 --\x3e\n  <div bsModal #delModal="bs-modal" class="modal fade" tabindex="1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button class="close" aria-label="Close" (click)="canceldDelModal()">\n            <span aria-hidden="true">&times;</span>\n          </button>\n          <h4 class="modal-title">\u786e\u8ba4\u64cd\u4f5c</h4>\n        </div>\n        <div class="modal-body">\n          <div class="message">\n            <span class="icon text-warning">\n              <i class="ion-md-information-circle-outline"></i>\n            </span>\n            <span>\u786e\u5b9a\u8981\u5220\u9664{{ activeAnnouncement ? \'\u8fd9\u6761\' : \'\u9009\u4e2d\' }}\u516c\u544a\u5417\uff1f</span>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <button class="btn btn-primary confirm-btn" (click)="(activeAnnouncement ? doDelAnnouncement() : doDelAnnouncements())">\u786e\u8ba4\u5220\u9664</button>\n          <span>&nbsp;&nbsp;</span>\n          <button class="btn btn-default confirm-btn" (click)="canceldDelModal()">\u53d6\u6d88</button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},T4lg:function(n,t){n.exports=".announcement-form .announcement-content {\n  padding: 0; }\n  .announcement-form .announcement-content > .markdown-editor > .editor-toolbar > .menus .quote,\n  .announcement-form .announcement-content > .markdown-editor > .editor-toolbar > .menus .code,\n  .announcement-form .announcement-content > .markdown-editor > .editor-toolbar > .menus .-h3,\n  .announcement-form .announcement-content > .markdown-editor > .editor-toolbar > .menus .image,\n  .announcement-form .announcement-content > .markdown-editor > .editor-toolbar > .menus .save {\n    display: none; }\n  .announcement-search-form > .input-group > .form-control {\n  width: 16em; }\n  .announcement-list {\n  position: relative; }\n  .announcement-list .batch-checkbox {\n    text-align: left;\n    padding-left: 2em; }\n  .announcement-list .announcement-err-msg {\n    margin: 1em 0; }\n  .announcement-list tbody tr td {\n    line-height: 5em; }\n  .announcement-list tbody tr td .content {\n      word-break: break-all;\n      line-height: 2.6; }\n  .announcement-list tbody tr td .content p {\n        margin: 0; }\n  .announcement-list tbody tr td .content img {\n        max-width: 4em;\n        margin: 0 1em; }\n"},iE5R:function(n,t,e){"use strict";e.r(t);var o=e("CcnG"),a=e("Ip0R"),s=e("gIcY"),i=e("+Dal"),c=e("N31z"),l=e("ZYCi"),r=e("DlQD"),d=e.n(r),u=e("LvDl"),p=e("6p9a"),h=e("o0su"),m=e("ydHt"),b=e("Shlh"),f=function(n,t,e,o){var a,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(n,t,e,o);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(i=(s<3?a(i):s>3?a(t,e,i):a(t,e))||i);return s>3&&i&&Object.defineProperty(t,e,i),i},g=function(n,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(n,t)},v={content:"",state:m.c.published},y={keyword:""},S=function(){function n(n,t){this._fb=n,this._httpService=t,this.PublishState=m.c,this.controlStateClass=b.a,this._apiPath=p.a,this.activeAnnouncement=null,this.announcementsSelectAll=!1,this.selectedAnnouncements=[],this.publishState=m.c.all,this.fetching={get:!1},this.announcements={data:[],pagination:null},this.editForm=this._fb.group({content:[v.content,s.i.compose([s.i.required])],state:[v.state,s.i.compose([s.i.required])]}),this.searchForm=this._fb.group({keyword:[y.keyword,s.i.compose([s.i.required])]}),Object(b.d)(this,this.editForm),Object(b.d)(this,this.searchForm)}return n.prototype.ngOnInit=function(){d.a.setOptions({renderer:new d.a.Renderer,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1}),this.getAnnouncements()},Object.defineProperty(n.prototype,"currentListTotal",{get:function(){var n=this.announcements.pagination;return n&&n.total||0},enumerable:!0,configurable:!0}),n.prototype.parseMarkdown=function(n){return d()(n)},n.prototype.isState=function(n){return this.publishState===n},n.prototype.switchState=function(n){n!==this.publishState&&(this.publishState=n,this.getAnnouncements())},n.prototype.resetEditForm=function(){this.editForm.reset(v),this.activeAnnouncement=null},n.prototype.resetSearchForm=function(){this.searchForm.reset(y)},n.prototype.editAnnouncement=function(n){this.activeAnnouncement=u.cloneDeep(n),this.editForm.reset(n)},n.prototype.submitEditForm=function(n){this.editForm.valid&&(this.activeAnnouncement?this.putAnnouncement(n):this.addAnnouncement(n))},n.prototype.submitSearchForm=function(){this.searchForm.valid&&this.getAnnouncements()},n.prototype.openDelModal=function(n){this.activeAnnouncement=u.cloneDeep(n),this.delModal.show()},n.prototype.canceldDelModal=function(){this.delModal.hide(),this.activeAnnouncement=null},n.prototype.openBatchDelModal=function(){this.activeAnnouncement=null,this.delModal.show()},n.prototype.handleBatchSelectChange=function(n){var t=this.announcements.data,e=this.selectedAnnouncements;this.selectedAnnouncements=Object(b.b)({data:t,selectedIds:e,isSelect:n})},n.prototype.handleItemSelectChange=function(){var n=this.announcements.data,t=this.selectedAnnouncements,e=Object(b.c)({data:n,selectedIds:t});this.announcementsSelectAll=e.all,this.selectedAnnouncements=e.selectedIds},n.prototype.handlePageChanged=function(n){this.getAnnouncements({page:n.page})},n.prototype.refreshAnnouncements=function(){this.getAnnouncements({page:this.announcements.pagination.current_page})},n.prototype.getAnnouncements=function(n){var t=this;return void 0===n&&(n={}),this.keyword.value&&(n.keyword=this.keyword.value),this.publishState!==m.c.all&&(n.state=this.publishState),this.fetching.get=!0,this._httpService.get(this._apiPath,n).then(function(n){t.announcements=n.result,t.selectedAnnouncements=[],t.announcementsSelectAll=!1,t.fetching.get=!1}).catch(function(n){t.fetching.get=!1})},n.prototype.addAnnouncement=function(n){var t=this;return this._httpService.post(this._apiPath,n).then(function(n){t.resetEditForm(),t.refreshAnnouncements()})},n.prototype.putAnnouncement=function(n){var t=this;return this._httpService.put(this._apiPath+"/"+this.activeAnnouncement._id,Object.assign(this.activeAnnouncement,n)).then(function(n){t.resetEditForm(),t.refreshAnnouncements(),t.activeAnnouncement=null})},n.prototype.doDelAnnouncement=function(){var n=this;this._httpService.delete(this._apiPath+"/"+this.activeAnnouncement._id).then(function(t){n.delModal.hide(),n.activeAnnouncement=null,n.refreshAnnouncements()}).catch(function(t){n.delModal.hide()})},n.prototype.doDelAnnouncements=function(){var n=this;this._httpService.delete(this._apiPath,{announcements:this.selectedAnnouncements}).then(function(t){n.delModal.hide(),n.refreshAnnouncements(),n.selectedAnnouncements=[]}).catch(function(t){n.delModal.hide()})},f([Object(o.ViewChild)("delModal"),g("design:type",i.b)],n.prototype,"delModal",void 0),n=f([Object(o.Component)({selector:"page-announcement",encapsulation:o.ViewEncapsulation.None,styles:[e("T4lg")],template:e("MUEz")}),g("design:paramtypes",[s.a,h.a])],n)}(),w=[{path:"",component:S}],A=l.d.forChild(w),k=function(n,t,e,o){var a,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(n,t,e,o);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(i=(s<3?a(i):s>3?a(t,e,i):a(t,e))||i);return s>3&&i&&Object.defineProperty(t,e,i),i},x=function(){function n(){}return n=k([Object(o.NgModule)({imports:[a.CommonModule,s.h,i.d.forRoot(),i.a.forRoot(),i.c.forRoot(),s.c,c.a,A],providers:[],declarations:[S]})],n)}();t.default=x}}]);